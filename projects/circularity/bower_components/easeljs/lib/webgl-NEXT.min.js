this.createjs=this.createjs||{},function(){"use strict";function t(t){this.Container_constructor(),this.spriteSheet=t}var e=createjs.extend(t,createjs.Container);e.addChild=function(t){return null==t?t:arguments.length>1?this.addChildAt.apply(this,Array.prototype.slice.call(arguments).concat([this.children.length])):this.addChildAt(t,this.children.length)},e.addChildAt=function(t,e){var i=arguments.length,r=arguments[i-1];if(0>r||r>this.children.length)return arguments[i-2];if(i>2){for(var a=0;i-1>a;a++)this.addChildAt(arguments[a],r+a);return arguments[i-2]}if(!(t._spritestage_compatibility>=1))return console&&console.log("Error: You can only add children of type SpriteContainer, Sprite, BitmapText, or DOMElement ["+t.toString()+"]"),t;if(t._spritestage_compatibility<=4){var s=t.spriteSheet;if(!s||!s._images||s._images.length>1||this.spriteSheet&&this.spriteSheet!==s)return console&&console.log("Error: A child's spriteSheet must be equal to its parent spriteSheet and only use one image. ["+t.toString()+"]"),t;this.spriteSheet=s}return t.parent&&t.parent.removeChild(t),t.parent=this,this.children.splice(e,0,t),t},e.toString=function(){return"[SpriteContainer (name="+this.name+")]"},createjs.SpriteContainer=createjs.promote(t,"Container")}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e,i){this.Stage_constructor(t),this._preserveDrawingBuffer=e||!1,this._antialias=i||!1,this._viewportWidth=0,this._viewportHeight=0,this._projectionMatrix=null,this._webGLContext=null,this._webGLErrorDetected=!1,this._clearColor=null,this._maxTexturesPerDraw=1,this._maxBoxesPointsPerDraw=null,this._maxBoxesPerDraw=null,this._maxIndicesPerDraw=null,this._shaderProgram=null,this._vertices=null,this._verticesBuffer=null,this._indices=null,this._indicesBuffer=null,this._currentBoxIndex=-1,this._drawTexture=null,this._initializeWebGL()}[createjs.SpriteContainer,createjs.Sprite,createjs.BitmapText,createjs.Bitmap,createjs.DOMElement].forEach(function(t,e){t.prototype._spritestage_compatibility=e+1});var e=createjs.extend(t,createjs.Stage);t.NUM_VERTEX_PROPERTIES=5,t.POINTS_PER_BOX=4,t.NUM_VERTEX_PROPERTIES_PER_BOX=t.POINTS_PER_BOX*t.NUM_VERTEX_PROPERTIES,t.INDICES_PER_BOX=6,t.MAX_INDEX_SIZE=65536,t.MAX_BOXES_POINTS_INCREMENT=t.MAX_INDEX_SIZE/4,e._get_isWebGL=function(){return!!this._webGLContext};try{Object.defineProperties(e,{isWebGL:{get:e._get_isWebGL}})}catch(i){}e.addChild=function(t){return null==t?t:arguments.length>1?this.addChildAt.apply(this,Array.prototype.slice.call(arguments).concat([this.children.length])):this.addChildAt(t,this.children.length)},e.addChildAt=function(t,e){var i=arguments.length,r=arguments[i-1];if(0>r||r>this.children.length)return arguments[i-2];if(i>2){for(var a=0;i-1>a;a++)this.addChildAt(arguments[a],r+a);return arguments[i-2]}return t._spritestage_compatibility>=1?t.image||t.spriteSheet||!(t._spritestage_compatibility<=4)?(t.parent&&t.parent.removeChild(t),t.parent=this,this.children.splice(e,0,t),t):(console&&console.log("Error: You can only add children that have an image or spriteSheet defined on them. ["+t.toString()+"]"),t):(console&&console.log("Error: You can only add children of type SpriteContainer, Sprite, Bitmap, BitmapText, or DOMElement. ["+t.toString()+"]"),t)},e.update=function(t){if(this.canvas){this.tickOnUpdate&&this.tick(t),this.dispatchEvent("drawstart"),this.autoClear&&this.clear();var e=this._setWebGLContext();e?this.draw(e,!1):((e=this.canvas.getContext("2d")).save(),this.updateContext(e),this.draw(e,!1),e.restore()),this.dispatchEvent("drawend")}},e.clear=function(){if(this.canvas){var t=this._setWebGLContext();t?t.clear(t.COLOR_BUFFER_BIT):((t=this.canvas.getContext("2d")).setTransform(1,0,0,1,0,0),t.clearRect(0,0,this.canvas.width+1,this.canvas.height+1))}},e.draw=function(t,e){return"undefined"!=typeof WebGLRenderingContext&&(t===this._webGLContext||t instanceof WebGLRenderingContext)?(this._drawWebGLKids(this.children,t),!0):this.Stage_draw(t,e)},e.updateViewport=function(t,e){this._viewportWidth=t,this._viewportHeight=e,this._webGLContext&&(this._webGLContext.viewport(0,0,this._viewportWidth,this._viewportHeight),this._projectionMatrix||(this._projectionMatrix=new Float32Array([0,0,0,0,0,1,-1,1,1])),this._projectionMatrix[0]=2/t,this._projectionMatrix[4]=-2/e)},e.clearImageTexture=function(t){t.__easeljs_texture=null},e.toString=function(){return"[SpriteStage (name="+this.name+")]"},e._initializeWebGL=function(){this._clearColor={r:0,g:0,b:0,a:0},this._setWebGLContext()},e._setWebGLContext=function(){return this.canvas?this._webGLContext&&this._webGLContext.canvas===this.canvas||this._initializeWebGLContext():this._webGLContext=null,this._webGLContext},e._initializeWebGLContext=function(){var t={depth:!1,alpha:!0,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias,premultipliedAlpha:!0},e=this._webGLContext=this.canvas.getContext("webgl",t)||this.canvas.getContext("experimental-webgl",t);if(e){if(this._maxTexturesPerDraw=1,this._setClearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a),e.enable(e.BLEND),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),this._createShaderProgram(e),this._webGLErrorDetected)return void(this._webGLContext=null);this._createBuffers(e),this.updateViewport(this._viewportWidth||this.canvas.width||0,this._viewportHeight||this.canvas.height||0)}},e._setClearColor=function(t,e,i,r){this._clearColor.r=t,this._clearColor.g=e,this._clearColor.b=i,this._clearColor.a=r,this._webGLContext&&this._webGLContext.clearColor(t,e,i,r)},e._createShaderProgram=function(t){var e=this._createShader(t,t.FRAGMENT_SHADER,"precision mediump float;uniform sampler2D uSampler0;varying vec3 vTextureCoord;void main(void) {vec4 color = texture2D(uSampler0, vTextureCoord.st);gl_FragColor = vec4(color.rgb, color.a * vTextureCoord.z);}"),i=this._createShader(t,t.VERTEX_SHADER,"attribute vec2 aVertexPosition;attribute vec3 aTextureCoord;uniform mat3 uPMatrix;varying vec3 vTextureCoord;void main(void) {vTextureCoord = aTextureCoord;gl_Position = vec4((uPMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);}");if(!this._webGLErrorDetected&&e&&i){var r=t.createProgram();if(t.attachShader(r,e),t.attachShader(r,i),t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS))return void(this._webGLErrorDetected=!0);r.vertexPositionAttribute=t.getAttribLocation(r,"aVertexPosition"),r.textureCoordAttribute=t.getAttribLocation(r,"aTextureCoord"),r.sampler0uniform=t.getUniformLocation(r,"uSampler0"),t.enableVertexAttribArray(r.vertexPositionAttribute),t.enableVertexAttribArray(r.textureCoordAttribute),r.pMatrixUniform=t.getUniformLocation(r,"uPMatrix"),t.useProgram(r),this._shaderProgram=r}},e._createShader=function(t,e,i){var r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(this._webGLErrorDetected=!0,null)},e._createBuffers=function(e){this._verticesBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._verticesBuffer);var i=4*t.NUM_VERTEX_PROPERTIES;e.vertexAttribPointer(this._shaderProgram.vertexPositionAttribute,2,e.FLOAT,e.FALSE,i,0),e.vertexAttribPointer(this._shaderProgram.textureCoordAttribute,3,e.FLOAT,e.FALSE,i,8),this._indicesBuffer=e.createBuffer(),this._setMaxBoxesPoints(e,t.MAX_BOXES_POINTS_INCREMENT)},e._setMaxBoxesPoints=function(e,i){this._maxBoxesPointsPerDraw=i,this._maxBoxesPerDraw=this._maxBoxesPointsPerDraw/t.POINTS_PER_BOX|0,this._maxIndicesPerDraw=this._maxBoxesPerDraw*t.INDICES_PER_BOX,e.bindBuffer(e.ARRAY_BUFFER,this._verticesBuffer),this._vertices=new Float32Array(this._maxBoxesPerDraw*t.NUM_VERTEX_PROPERTIES_PER_BOX),e.bufferData(e.ARRAY_BUFFER,this._vertices,e.DYNAMIC_DRAW),this._indices=new Uint16Array(this._maxIndicesPerDraw);for(var r=0,a=this._indices.length;a>r;r+=t.INDICES_PER_BOX){var s=r*t.POINTS_PER_BOX/t.INDICES_PER_BOX;this._indices[r]=s,this._indices[r+1]=s+1,this._indices[r+2]=s+2,this._indices[r+3]=s,this._indices[r+4]=s+2,this._indices[r+5]=s+3}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indicesBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this._indices,e.STATIC_DRAW)},e._setupImageTexture=function(t,e){if(e&&(e.naturalWidth||e.getContext||e.readyState>=2)){var i=e.__easeljs_texture;return i||(i=e.__easeljs_texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),i}},e._drawWebGLKids=function(e,i,r){for(var a,s,n=this.snapToPixelEnabled,o=null,h=0,c=0,l=0,d=0,u=this._vertices,x=t.NUM_VERTEX_PROPERTIES_PER_BOX,E=t.MAX_INDEX_SIZE,p=this._maxBoxesPerDraw-1,f=0,T=e.length;T>f;f++)if((a=e[f]).isVisible()){var o=a.image||a.spriteSheet&&a.spriteSheet._images[0],g=o.__easeljs_texture;if(g||(g=this._setupImageTexture(i,o))){s=a._props.matrix,s=(r?s.copy(r):s.identity()).appendTransform(a.x,a.y,a.scaleX,a.scaleY,a.rotation,a.skewX,a.skewY,a.regX,a.regY);var P=0,m=1,S=0,v=1;if(4===a._spritestage_compatibility)h=0,c=0,l=o.width,d=o.height;else if(2===a._spritestage_compatibility){var R=a.spriteSheet.getFrame(a.currentFrame),C=R.rect;h=-R.regX,c=-R.regY,l=h+C.width,d=c+C.height,P=C.x/o.width,S=C.y/o.height,m=P+C.width/o.width,v=S+C.height/o.height}else o=null,3===a._spritestage_compatibility&&a._updateText();if(!r&&a._spritestage_compatibility<=4&&g!==this._drawTexture&&(this._drawToGPU(i),this._drawTexture=g),null!==o){var w=++this._currentBoxIndex*x,b=s.a,A=s.b,B=s.c,$=s.d,L=s.tx,D=s.ty;n&&a.snapToPixel&&(L=L+(0>L?-.5:.5)|0,D=D+(0>D?-.5:.5)|0),u[w]=h*b+c*B+L,u[w+1]=h*A+c*$+D,u[w+5]=h*b+d*B+L,u[w+6]=h*A+d*$+D,u[w+10]=l*b+d*B+L,u[w+11]=l*A+d*$+D,u[w+15]=l*b+c*B+L,u[w+16]=l*A+c*$+D,u[w+2]=u[w+7]=P,u[w+12]=u[w+17]=m,u[w+3]=u[w+18]=S,u[w+8]=u[w+13]=v,u[w+4]=u[w+9]=u[w+14]=u[w+19]=a.alpha,this._currentBoxIndex===p&&(this._drawToGPU(i),this._drawTexture=g,this._maxBoxesPointsPerDraw<E&&(this._setMaxBoxesPoints(i,this._maxBoxesPointsPerDraw+t.MAX_BOXES_POINTS_INCREMENT),p=this._maxBoxesPerDraw-1))}a.children&&(this._drawWebGLKids(a.children,i,s),p=this._maxBoxesPerDraw-1)}}r||this._drawToGPU(i)},e._drawToGPU=function(e){if(this._drawTexture){var i=this._currentBoxIndex+1;e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this._drawTexture),e.uniform1i(this._shaderProgram.sampler0uniform,0),e.bindBuffer(e.ARRAY_BUFFER,this._verticesBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indicesBuffer),e.uniformMatrix3fv(this._shaderProgram.pMatrixUniform,!1,this._projectionMatrix),e.bufferSubData(e.ARRAY_BUFFER,0,this._vertices),e.drawElements(e.TRIANGLES,i*t.INDICES_PER_BOX,e.UNSIGNED_SHORT,0),this._currentBoxIndex=-1,this._drawTexture=null}},createjs.SpriteStage=createjs.promote(t,"Stage")}();
