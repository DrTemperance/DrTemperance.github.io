<html lang='en'>

<head>
	<meta charset='UTF-8' />
	<title> Time Rift Prototype | 1980s </title>
	<link href='riftStylePrototype.css' rel='stylesheet' />
	<script async src='stories!/80s/scripting/playerscripting.js'></script>
	<script async src='stories!/80s/scripting/data.js'></script>
	<link href='https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,500,1,0' rel='stylesheet' />
	<meta content='width=device-width, height=device-height, initial-scale=1' name='viewport' />
</head>

<audio class='80sAssets' id='clicksound' preload='auto' src='click.flac'></audio>
<body class='80sMode'>

<div id='custom-cursor' style='display: none;'>
</div>
<div class='column reversed' id='content'>
	<img class='80sAssets' id='scanlines' src='stories!/80s/crtscanlines.gif' />
	<div id='console-log'></div>
	<div class='column reversed inputParent'>
		<div class='row'>
			<span id='prompt'>>_</span>
			<input alt='terminal input' autocomplete='off' id='terminal' maxlength='90' spellcheck='false' type='text' value='' />
			<span class='material-symbols-outlined' id='configButton'>more_vert</span>
		</div>
	</div>
	<button style='border: none;position: fixed; left:1161px;top: 696px;width: 50px;height: 30px;cursor: pointer; background: none;'
	></button>
	<span style='font-size: 1%; position: absolute; left: 56.5%; top: 78%; width: 100%; height: 100%; background: none; filter: drop-shadow(0 0 7px lime) blur(2px);'>*</span>
</div>
<dialog class='row' id='configMenu'>
	<aside class='columns' style='float: left;'>
		<button id='settingsOption' onclick='cycleSettings(0)'>
			Advanced User<br /><sub>Currently: <span id='auStatus'>...</span></sub>
		</button>
		<button id='settingsOption' onclick='cycleSettings(1)'>
			Graphics Settings<br /><sub>Currently: <span id='gStatus'>...</span></sub>
		</button>
	</aside>
	<aside class='columns' style='float: right;'>
		<button id='settingsOption' onclick='cycleSettings(3)'>unset 1<br /><sub>Currently: <span
						id='u1Status'>...</span></sub></button>
		<button id='settingsOption' onclick='cycleSettings(4)'>unset 2<br /><sub>Currently: <span
						id='u2Status'>...</span></sub></button>
	</aside>
	<span id='configClose' onclick="closeMenu('configClose')">Close Menu</span>
</dialog>

</body>

</html>

<script async>
  let config = {
	  custom   : {
		  settings: [
			  {
				  name    : 'AdvancedUser',
				  tooltip : 'Classic Terminal Experience',
				  status  : false,
				  possible: [false, true]
			  },
			  {
				  name    : 'null1',
				  tooltip : 'null1',
				  status  : 'null1',
				  possible: [`null1`, `null2`]
			  },
			  {
				  name    : 'null2',
				  tooltip : 'null2',
				  status  : 'null1',
				  possible: [`null1`, `null2`]
			  },
			  {
				  name    : 'null3',
				  tooltip : 'null3',
				  status  : 'null1',
				  possible: [`null1`, `null2`]
			  }
		  ]
	  },
	  constants: {
		  era          : `unset`,
		  currentPrompt: `>`,
		  prompt       : {'2000s': `$`, '1990s': `C:/`, '1980s': `>`, 'unset': '>_'}
	  }
  };

  document.getElementById('configButton')
          .addEventListener('click', () => {document.getElementById('configMenu').style.visibility = 'visible'});

  function closeMenu (e) {document.getElementById(e).parentElement.style.visibility = 'hidden'}

  function setEra (eraChoice) {
	  config.constants.era = eraChoice || 'unset';
	  config.constants.currentPrompt = prompt[eraChoice];
  }
</script>

<script async>
  const {style} = document.getElementById('custom-cursor');

  document.addEventListener('DOMContentLoaded', () =>
				  document.addEventListener('mousemove', ({clientX, clientY, pageX, pageY}) =>
				  {
					  const {bottom, left, right, top} = document.getElementById('console-log').getBoundingClientRect();

					  clientX>=left && clientX<=right && clientY>=top && clientY<=bottom
					  ? (document.body.style.cursor = 'none', style.display = 'block',
									  style.left = `${pageX}px`, style.top = `${pageY}px`)
					  : (document.body.style.cursor = 'auto', style.display = 'none')
				  }));

  // Terminal functionality //
  const
				  terminalElement = document.getElementById('terminal'),
				  Console_Log     = document.getElementById('console-log'),
				  commandHistory  = [];

  let commandIndex = -1;

  terminalElement.addEventListener('keydown', e =>
  {
	  if (e.key==='Enter' && terminalElement.value.trim()!=='') {
		  e.preventDefault();
		  addToHistory(terminalElement.value), inputHandler(convertToFunctionCall(terminalElement.value));
		  terminalElement.value = '';
		  commandIndex = -1;
	  }
	  if (e.key==='ArrowUp' && commandIndex!==commandHistory.length - 1) {
		  commandIndex++, terminalElement.value = commandHistory[commandIndex];
	  }
	  if (e.key==='ArrowDown') {
		  commandIndex===0 && (commandIndex--, terminalElement.value = '');
		  commandIndex!== -1 && (commandIndex--, terminalElement.value = commandHistory[commandIndex]);
	  }
  });

  function inputHandler (rawInput) {
	  try {
		  const result = eval(rawInput);
		  addToConsole(rawInput, JSON.stringify(result));
	  } catch (e) {addToConsole(rawInput, e)}
  }

  const addToHistory = i =>
	  {
		  commandHistory.unshift(i);
		  commandIndex = -1;
		  commandHistory.length>=30 && commandHistory.pop();
	  };

  function addToConsole (command, result) {
	  let li1 = document.createElement('li');
	  li1.innerHTML = `${config.constants.currentPrompt} ${command} <br><br> ${result}`;
	  Console_Log.appendChild(li1);
  }

  function convertToFunctionCall (input) {
	  let index, argument, functionName;
	  const lowerInput = input.toLowerCase();

	  switch (true) {
		  case lowerInput.includes('go'):
			  index = lowerInput.indexOf(' to');
			  if (index=== -1) {return `${lowerInput}`} else {
				  functionName = lowerInput.substring(0, index);
				  argument = lowerInput.substring(index + 4).replace(/ /g, '');
				  return `${functionName}('${argument}')`;
			  }
		  case lowerInput.includes('inspect') || lowerInput.includes('enter'):
			  index = lowerInput.indexOf(' ');
			  if (index=== -1) {return `${lowerInput}`} else {
				  functionName = lowerInput.substring(0, index);
				  argument = lowerInput.substring(index).replace(/ /g, '');
				  return `${functionName}(${argument})`;
			  }
		  default:
			  return `${lowerInput}`;
	  }
  }
</script>