<html lang='EN'>
<head>
	<meta charset='UTF-8' />
	<title> Time Rift | Prototype </title>
	<link href='riftStylePrototype.css' rel='stylesheet' />
	<link href='https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,500,1,0' rel='stylesheet' />
	<meta content='width=device-width, height=device-height, initial-scale=1' name='viewport' />
</head>


<body class='80s_Mode'>
<audio id='KeyPress_80s' src='Stories/1980s/Audio/Keypress.mp3' preload='auto'></audio>

<aside class='Column' style='float: left; padding: 10px;'>
	<button class='Active' id='TextMode' onclick='this.classList.toggle("Active"), this.classList.toggle("Inactive");document.getElementById(`GUIMode`).classList.toggle("Active"), document.getElementById(`GUIMode`).classList.toggle("Inactive");'>Text Mode</button>
	<button class='Inactive' id='GUIMode' onclick='this.classList.toggle("Active"), this.classList.toggle("Inactive");document.getElementById(`TextMode`).classList.toggle("Active"), document.getElementById(`TextMode`).classList.toggle("Inactive");'>GUI Mode</button>
</aside>

<div id='Pseudo_Cursor' style='display: none;'></div>
<div class='Column Reversed' id='Content'>
	<img class='Assets_80s' id='Scanlines' src='Stories/1980s/Scanlines.gif' />
	<div id='Console-Output'></div>
	<div class='Column Reversed InputParent'>
		<div class='Row'>
			<span id='Prompt'>>_</span>
			<input autocomplete='off' id='Terminal' maxlength='90' spellcheck='false' type='Text' value='' />
			<span class='material-symbols-outlined' id='Settings_Button'>more_vert</span>
		</div>
	</div>
	<button style='border: none;position: fixed; left:1161px;top: 696px;width: 50px;height: 30px;cursor: pointer; background: none;'
	></button>
	<span style='font-size: 1%; position: absolute; left: 56.5%; top: 78%; width: 100%; height: 100%; background: none; filter: drop-shadow(0 0 7px lime) blur(2px);'>*</span>
</div>
<dialog class='Row' id='SettingsMenu'>
	<aside class='Column' style='float: left;'>
		<button id='Option' onclick='cycleSettings(0)'>
			Advanced User<br /><sub>Currently: <span id='ADV-U_Status'>...</span></sub>
		</button>
		<button id='Option' onclick='cycleSettings(1)'>
			Graphics Settings<br /><sub>Currently: <span id='Gra_Status'>...</span></sub>
		</button>
	</aside>
	<aside class='Column'>
		<button id='Option' onclick='cycleSettings(3)'>unset 1<br /><sub>Currently: <span
						id='U1_Status'>...</span></sub></button>
		<button id='Option' onclick='cycleSettings(4)'>unset 2<br /><sub>Currently: <span
						id='U2_Status'>...</span></sub></button>
	</aside>
	<span id='ConfigClose' onclick="this.parentElement.style.visibility = 'hidden'">Close Menu</span>
</dialog>

</body>
<script>
  const Elements = {
	  TerminalInput : document.getElementById('Terminal'),
	  PsuedoConsole : document.getElementById('Console-Output'),
	  Cursor        : document.getElementById('Pseudo_Cursor'),
	  ContentWindow : document.getElementById('Content'),
	  SettingsButton: document.getElementById('Settings_Button'),
	  SettingsMenu  : document.getElementById('SettingsMenu'),
	  InputBox      : document.querySelector('.InputParent'),
	  Scanlines     : document.getElementById('Scanlines')
  };

  let Config = {
	      Custom   : {
		      Settings: [
			      {
				      name    : 'AdvancedUser',
				      tooltip : 'Classic Terminal Experience',
				      status  : false,
				      possible: [false, true]
			      },
			      {
				      name    : 'null1',
				      tooltip : 'null1',
				      status  : 'null1',
				      possible: [`null1`, `null2`]
			      },
			      {
				      name    : 'null2',
				      tooltip : 'null2',
				      status  : 'null1',
				      possible: [`null1`, `null2`]
			      },
			      {
				      name    : 'null3',
				      tooltip : 'null3',
				      status  : 'null1',
				      possible: [`null1`, `null2`]
			      }
		      ]
	      },
	      Constants: {
		      era          : `unset`,
		      currentPrompt: `>`,
		      prompt       : {'2000s': `$`, '1990s': `C:/`, '1980s': `>`, 'unset': '>_'}
	      }
      },
      Player = {
	      Command: {
		      Index: -1, History: []
	      }
      };
  Elements.SettingsButton.addEventListener('click', ()=>Elements.SettingsMenu.style.visibility = 'visible');

  // Terminal functionality //
  Elements.TerminalInput.addEventListener('keydown', async e=>{
	  switch (e.key) {
		  case 'Enter':
			  e.preventDefault();
			  if (Elements.TerminalInput.value.trim()==='') new Audio('./Stories/1980s/Audio/Error.mp3').play();
			  else {
				  Player.Command.History.unshift(Elements.TerminalInput.value);
				  Player.Command.Index = -1;
				  Player.Command.History.length>=30 && Player.Command.History.pop();
				  ComputeInput(Functionalize(Elements.TerminalInput.value));
				  Elements.TerminalInput.value = '';
			  }

		  case 'ArrowUp':
			  e.preventDefault();
			  Player.Command.Index = Player.Command.Index===Player.Command.History.length - 1
			                         ? Player.Command.Index : Player.Command.Index + 1;
			  Elements.TerminalInput.value = Player.Command.History[Player.Command.Index];

		  case 'ArrowDown':
			  e.preventDefault();
			  Player.Command.Index===0 && (Player.Command.Index--, Elements.TerminalInput.value = '');
			  Player.Command.Index!== -1 && (Player.Command.Index--, Elements.TerminalInput.value = Player.Command.History[Player.Command.Index]);

		  default:
			  new Audio('./Stories/1980s/Audio/Keypress.mp3').play();
			  break;
	  }
  });

  async function ComputeInput(Prompt) {
	  try {
		  Console_Log(Prompt, JSON.stringify(await eval(Prompt))).catch(Error=>Console_Log(Prompt, Error.toString()));
	  }
	  catch (Error) {Console_Log(Prompt, Error.toString())}
  }

  async function Console_Log(Prompt, Result) {
	  let Output = await document.createElement('li');
	  Output.innerHTML = `${Config.Constants.currentPrompt} ${Prompt} <br><br> ${Result}`;
	  await Elements.PsuedoConsole.appendChild(Output);
	  Elements.PsuedoConsole.scrollTop = Elements.PsuedoConsole.scrollHeight;
  }

  function Functionalize(Input) {
	  switch (true) {
		  case Input.toLowerCase().includes('go'):
			  if (Input.toLowerCase().indexOf(' to')=== -1) return Input.toLowerCase();
			  return `${Input.toLowerCase().substring(0, Input.toLowerCase().indexOf(' to'))}('${Input.toLowerCase().substring(Input.toLowerCase().indexOf(' to')).replace(/ /g, '')}')`;

		  case Input.toLowerCase().includes('inspect') || Input.toLowerCase().includes('enter'):
			  if (Input.toLowerCase().indexOf(' to')=== -1) return Input.toLowerCase();
			  return `${Input.toLowerCase().substring(0, Input.toLowerCase().indexOf(' to'))}(${Input.toLowerCase().substring(Input.toLowerCase().indexOf(' to')).replace(/ /g, '')})`;

		  default:
			  return `${Input.toLowerCase()}`;
	  }
  }


  const PlaceContent = async ()=>{
	  Elements.ContentWindow.style.right = `${(window.innerWidth / 4)}px`;
	  Elements.ContentWindow.style.width = `${window.innerWidth / 2}px`;
	  Elements.ContentWindow.style.height = `${window.innerHeight}px`;
	  Elements.Scanlines.style.width = `${Elements.ContentWindow.getBoundingClientRect().width / 1.3}px`;
	  Elements.Scanlines.style.height = `${Elements.ContentWindow.getBoundingClientRect().height / 1.825}px`;
	  Elements.Scanlines.style.top = `${Elements.ContentWindow.offsetTop / 0.5}px`;
	  Elements.PsuedoConsole.style.height = `${Elements.ContentWindow.getBoundingClientRect().height / 2}px`;
	  Elements.PsuedoConsole.style.width = `${Elements.ContentWindow.getBoundingClientRect().width / 1.3}px`;
	  Elements.PsuedoConsole.style.top = `${Elements.ContentWindow.offsetTop + window.innerHeight / 8.85}px`;
	  Elements.InputBox.style.top = `${window.innerHeight / 1.575}px`;
	  Elements.InputBox.style.left = `${window.innerWidth / 3.25}px`;
	  Elements.InputBox.style.width = `${Elements.PsuedoConsole.innerWidth}px`;
  };

  document.addEventListener('DOMContentLoaded', async ()=>{
	  Elements.ContentWindow.style.position = 'fixed';
	  Elements.Scanlines.style.position = 'fixed';
	  Elements.PsuedoConsole.style.position = 'fixed';
	  Elements.InputBox.style.position = 'fixed';
	  PlaceContent();
	  window.addEventListener('resize', ()=>window.requestAnimationFrame(PlaceContent()));

	  document.addEventListener('mousemove', ({clientX, clientY, pageX, pageY})=>{
		  const {bottom, left, right, top} = Elements.PsuedoConsole.getBoundingClientRect();
		  clientX>=left && clientX<=right && clientY>=top && clientY<=bottom
		  ? window.requestAnimationFrame(
						  document.body.style.cursor = 'none',
						  Elements.Cursor.style.display = 'block',
						  Elements.Cursor.style.left = `${pageX}px`,
						  Elements.Cursor.style.top = `${pageY}px`
		  )
		  : window.requestAnimationFrame(document.body.style.cursor = 'default', Elements.Cursor.style.display = 'none');
	  });
  });
</script>
</html>